!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/platform-browser"),require("@angular/common"),require("rxjs/BehaviorSubject"),require("@angular/router"),require("rxjs/operators"),require("@angular-redux/store")):"function"==typeof define&&define.amd?define("context",["exports","@angular/core","@angular/platform-browser","@angular/common","rxjs/BehaviorSubject","@angular/router","rxjs/operators","@angular-redux/store"],e):e(t.context={},t.ng.core,t.ng.platformBrowser,t.ng.common,t.rxjs.BehaviorSubject,t.ng.router,t.rxjs.operators,null)}(this,function(t,r,e,n,o,i,a,u){"use strict";var s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function c(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return a}var f=new r.InjectionToken("contextConfig"),d={useTitleSuffix:!1,extendTitle:!1,titleDelimiter:" | ",defaults:{},routerContext:!0},l=function(){function t(t,e,r){this.metaConfig=t,this.document=e,this.titleService=r,this.metaConfig=s({},d,t)}return t.prototype.updateMetaTags=function(t){var e=this;if(void 0===t&&(t={}),!t.disableUpdate){var r=s({},t,this.metaConfig.defaults,{title:this.getTitle(t)});Object.keys(r).forEach(function(t){e.setTag(t,r)})}},t.prototype.setTag=function(t,e){switch(void 0===e&&(e={}),t){case"title":case"titleSuffix":return this.setTitle(e.title,e.titleSuffix);case"favIcon":return this.setFavIcon(e.favIcon);default:return this.setTagDefault(t,e[t])}},t.prototype.setTitle=function(t,e){void 0===e&&(e=this.metaConfig.defaults.titleSuffix);var r=this.isDefined(t)?t:this.metaConfig.defaults.title;this.metaConfig.useTitleSuffix&&this.isDefined(e)&&(r+=e),this.titleService.setTitle(r)},t.prototype.setFavIcon=function(t){this.updateFavIcon("apple-touch-icon",t),this.updateFavIcon("shortcut icon",t)},t.prototype.updateFavIcon=function(t,e,r){var n=this.document.querySelector('link[rel="'+t+'"]');if(!n||n.getAttribute("href")!==e){var o=this.document.createElement("link");o.setAttribute("rel",t),o.setAttribute("href",e),r&&Object.keys(r).forEach(function(t){o.setAttribute(t,r[t])}),n&&this.document.head.removeChild(n),this.document.head.appendChild(o)}},t.prototype.setTagDefault=function(t,e){var r=this.getOrCreateMetaTag(t),n=this.isDefined(e)?e:this.metaConfig.defaults[t]||"";(r.setAttribute("content",n),"description"===t)&&this.getOrCreateMetaTag("og:description").setAttribute("content",n)},t.prototype.isDefined=function(t){return void 0!==t},t.prototype.getOrCreateMetaTag=function(t){var e=this.document.querySelector("meta[name='"+t+"']");return e||((e=this.document.createElement("meta")).setAttribute("name",t),this.document.head.appendChild(e)),e},t.prototype.getTitle=function(t){return void 0===t&&(t={}),this.metaConfig.extendTitle&&t.parent?[t.title,t.parent].join(this.metaConfig.titleDelimiter):t.title},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:r.Inject,args:[f]}]},{type:undefined,decorators:[{type:r.Inject,args:[n.DOCUMENT]}]},{type:e.Title}]},t}(),p=function(){function t(t){this.contextWriter=t,this.context$=new o.BehaviorSubject(null)}return t.prototype.updateContext=function(t){this.contextWriter.updateMetaTags(t),this.context$.next(t)},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:l}]},t}(),h=[p,l],g=function(){function t(){}return t.getParentTitle=function(t,e){if(void 0===e&&(e=[]),!t)return e;var r=this.verifyPath(t,"parent.data.meta.title"),n=r?e.concat(r):e;return t.parent?this.getParentTitle(t.parent,n):n},t.verifyPath=function(t,e){for(var r=t,n=e.split("."),o=0;o<n.length;o+=1){if(!r[n[o]])return null;r=r[n[o]]}return r},t.findLastChild=function(t){for(var e=t.snapshot.firstChild;null!==e.firstChild;)e=e.firstChild;return e},t}(),v=d,x=function(){function e(t,e,r,n){var o=this;this.contextService=t,this.router=e,this.activatedRoute=r,(this.contextConfig=n).routerContext&&this.router.events.pipe(a.filter(function(t){return t instanceof i.NavigationEnd}),a.map(function(){return g.findLastChild(o.activatedRoute)})).subscribe(function(t){t.data=t.data||{},t.data.meta=t.data.meta||{},t.data.meta.parent=g.getParentTitle(t),o.contextService.updateContext(t.data.meta)})}return e.forRoot=function(t){return{ngModule:e,providers:function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}([{provide:f,useValue:t}],h)}},e.decorators=[{type:r.NgModule,args:[{imports:[i.RouterModule],providers:[h,{provide:f,useValue:v}]}]}],e.ctorParameters=function(){return[{type:p},{type:i.Router},{type:i.ActivatedRoute},{type:undefined,decorators:[{type:r.Inject,args:[f]}]}]},e}(),y="CONTEXT_LOAD",m=function(){function t(t,e,r){var n=this;this.contextService=t,this.contextWriter=e,this.ngRedux=r,t.context$.subscribe(function(t){return n.loadContext(t,!0)})}return t.prototype.loadContext=function(t,e){var r=this;if(!this.ngRedux._store)return this.subscribeToStore(function(){return r.loadContext(t,e)});this.ngRedux.dispatch({type:y,context:t}),e||this.contextWriter.updateMetaTags(t)},t.prototype.subscribeToStore=function(t){var e=this;this.onStoreLoaded=t,this.storeSubscription||(this.storeSubscription=this.ngRedux._store$.subscribe(function(t){t&&(e.storeSubscription.unsubscribe(),e.onStoreLoaded())}.bind(this)))},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:p},{type:l},{type:u.NgRedux}]},t}(),C=function(){function t(t){}return t.decorators=[{type:r.NgModule,args:[{imports:[u.NgReduxModule],providers:[m]}]}],t.ctorParameters=function(){return[{type:m}]},t}();t.ContextService=p,t.ContextWriterService=l,t.CONTEXT_CONFIG=f,t.CONTEXT_CONFIG_DEFAULT=d,t.ContextModule=x,t.ContextActionCreator=m,t.ContextStoreModule=C,t.contextReducer=function(t,e){switch(void 0===t&&(t=null),e.type){case y:return s({},e.context);default:return t}},t.CONTEXT_LOAD=y,t.Éµa=h,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=context.umd.min.js.map