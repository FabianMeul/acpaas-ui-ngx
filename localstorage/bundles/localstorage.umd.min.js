!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("lodash-es"),require("@acpaas-ui/ngx-components/utils"),require("rxjs/BehaviorSubject"),require("rxjs/add/operator/distinctUntilChanged"),require("rxjs/add/operator/map"),require("@angular-redux/store"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/first")):"function"==typeof define&&define.amd?define("localstorage",["exports","@angular/core","lodash-es","@acpaas-ui/ngx-components/utils","rxjs/BehaviorSubject","rxjs/add/operator/distinctUntilChanged","rxjs/add/operator/map","@angular-redux/store","rxjs/add/operator/filter","rxjs/add/operator/first"],t):t(e.localstorage={},e.ng.core,null,null,e.rxjs.BehaviorSubject,e.rxjs["add/operator/distinctUntilChanged"],e.rxjs["add/operator/map"],null)}(this,function(e,r,i,o,n,t,s,a){"use strict";var u=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},c=new r.InjectionToken("localstorageConfig"),p={storageType:"localStorage"},f=function(){function e(){}return e.select=function(e,t){return e?t?"function"==typeof t?t(e):Array.isArray(t)?this.verifyPath(e,t):this.verifyPath(e,[t]):e:null},e.keyMatches=function(e,t){var r=e===t,o=!!Array.isArray(t)&&0<=t.indexOf(e);return r||o||"function"==typeof t},e.verifyPath=function(e,t){if(!e||!t)return null;for(var r=e,o=0;o<t.length;o+=1){if(!r.hasOwnProperty(t[o]))return null;r=r[t[o]]}return r},e.updateOrCreatePath=function(e,t,r){if(!e||!t)return null;var o=e,n=0;for(n=0;n<t.length&&(o.hasOwnProperty(t[n])||(o[t[n]]={}),n!==t.length-1);n+=1)o=o[t[n]];return o[t[n]]=r,e},e.parseJSON=function(e,t){try{return JSON.parse(t)}catch(r){return console.warn('Parsing key "'+e+'" in localstorage failed, ignoring value.'),String(t)}},e.comparator=i.isEqual,e}(),l=new(function(){function e(){this.store=new Map}return Object.defineProperty(e.prototype,"length",{get:function(){return this.store.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storage",{get:function(){return Array.from(this.store.entries()).reduce(function(e,t){return u({},e,((r={})[t[0]]=t[1],r));var r},{})},enumerable:!0,configurable:!0}),e.prototype.key=function(e){return Array.from(this.store.keys())[e]},e.prototype.getItem=function(e){return this.store.get(e)},e.prototype.setItem=function(e,t){this.store.set(e,t)},e.prototype.removeItem=function(e){this.store["delete"](e)},e.prototype.clear=function(){this.store.clear()},e}()),g=new Proxy(l,{get:function(e,t,r){return t in e?Reflect.get(e,t,r):t in e.__proto__?e.__proto__[t]:e.storage?e.getItem(t):void 0},ownKeys:function(e){return Object.keys(e.storage)},getOwnPropertyDescriptor:function(){return{enumerable:!0,configurable:!0}}}),d=function(){function t(e,t){this.localstorageConfig=e,this.$window=t,this.subscribers=new Map,(this.instance=this).setStorage(e),this.validateStorage()}return Object.defineProperty(t.prototype,"instance",{get:function(){return t.instance},set:function(e){t.instance||(t.instance=e)},enumerable:!0,configurable:!0}),t.prototype.setStorage=function(e){var t=void 0===e?{}:e,r=t.storageType,o=t.identifier,n=void 0===o?"":o;this.storageType=this.verifyStorageType(r,"localStorage"),this.storage="memory"===this.storageType?g:this.$window[this.storageType],this.identifier=n},t.prototype.setItem=function(e,t){this.storage.setItem(e,JSON.stringify(t)),this.updateSubscribers(e)},t.prototype.getItem=function(e){return f.parseJSON(e,this.storage.getItem(e))},t.prototype.removeItem=function(e){this.storage.removeItem(e),this.updateSubscribers(e)},t.prototype.clear=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.storage.clear.apply(this.storage,e),this.updateSubscribers()},t.prototype.select=function(e,t){return void 0===t&&(t=f.comparator),Array.isArray(e)?this.getChildSubscription(e,this.select(e[0])).distinctUntilChanged(t):this.addSubscriber(e).distinctUntilChanged(t)},t.prototype.clearSubscribers=function(){this.subscribers.forEach(function(e){e.unsubscribe()})},t.prototype.getStorageSnapshot=function(){var r=this;return"memory"===this.storageType?{}:u({},Object.keys(this.storage).reduce(function(e,t){return e[t]=f.parseJSON(t,r.storage[t]),e},{}))},t.prototype.addSubscriber=function(e){return this.subscribers.has(e)||this.subscribers.set(e,new n.BehaviorSubject(f.select(this.getStorageSnapshot(),e))),this.subscribers.get(e)},t.prototype.validateStorage=function(){var e=this.getStorageSnapshot();(this.identifier||e["aui-storage"])&&this.identifier!==e["aui-storage"]&&(this.clear(),this.identifier&&this.setItem("aui-storage",this.identifier))},t.prototype.getChildSubscription=function(t,e){var r=this.addSubscriber(t);return e.map(function(e){return f.verifyPath(e,t.slice(1))}.bind(this)).subscribe(function(e){r.next(e)}),r},t.prototype.updateSubscribers=function(r){var o=this.getStorageSnapshot();this.subscribers.forEach(function(e,t){(r===undefined||f.keyMatches(r,t))&&e.next(f.select(o,t))})},t.prototype.verifyStorageType=function(e,t){return void 0===t&&(t="memory"),this.$window.hasOwnProperty(e)&&this.$window[e]instanceof this.$window.Storage?e:"memory"===e?"memory":this.verifyStorageType(t)},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:r.Inject,args:[c]}]},{type:undefined,decorators:[{type:r.Inject,args:[o.WINDOW]}]}]},t}(),h=p,y=window,b=function(){function t(e){this.localstorageService=e}return t.forRoot=function(e){return void 0===e&&(e=p),{ngModule:t,providers:[{provide:c,useValue:e},{provide:o.WINDOW,useValue:window},d]}},t.decorators=[{type:r.NgModule,args:[{imports:[],providers:[{provide:c,useValue:h},{provide:o.WINDOW,useValue:y},d]}]}],t.ctorParameters=function(){return[{type:d}]},t}();var S=function(){function e(e,t){this.ngRedux=e,this.localstorageService=t,this.subscribers=new Map}return e.prototype.enhancer=function(e){var o=this.selectFromState(e);return this.subscribe(e),function(r){return function(e,t){return r(e,u({},t,o))}}},e.prototype.subscribe=function(t){var r=this;this.ngRedux.select().filter(function(e){return!!e}).first().subscribe(function(e){t?t.forEach(function(e){return r.subscribeSelector(e)}):r.subscribeSelector("reduxState")})},e.prototype.subscribeSelector=function(o){var n=this;if(o){var e=this.subscribers.get(o);e&&e.unsubscribe(),this.subscribers.set(o,this.ngRedux.subscribe(function(){var e=Array.isArray(o)?o.join("."):String(o),t=n.localstorageService.getItem(e),r="reduxState"===o?n.ngRedux.getState():f.select(n.ngRedux.getState(),o);i.isEqual(t,r)||n.localstorageService.setItem(e,r)}))}},e.prototype.selectFromState=function(e){var n=this;return e&&e.length?e.reduce(function(e,t){var r=f.select(n.localstorageService.getStorageSnapshot(),t),o=Array.isArray(t)?t:[t];return f.updateOrCreatePath(e,o,r),e},{}):this.localstorageService.getItem("reduxState")},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:a.NgRedux},{type:d}]},e}(),v=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{imports:[a.NgReduxModule],providers:[S]}]}],e}();e.LocalstorageModule=b,e.LocalstorageHelper=f,e.LocalstorageService=d,e.LOCALSTORAGE_CONFIG=c,e.DEFAULT_LOCALSTORAGE_CONFIG=p,e.storage=function(o,n){return function(e,t){var r=o;o||(r=t.lastIndexOf("$")===t.length-1?t.substring(0,t.length-1):t),delete e[t],Object.defineProperty(e,t,{get:function(){return d.instance.select(r,n)},enumerable:!0,configurable:!0})}},e.LocalstorageStoreModule=v,e.LocalstorageReduxPlugin=S,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=localstorage.umd.min.js.map