/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Injectable } from '@angular/core';
import { DAYS, } from '../types/agenda.types';
export class DateHelperService {
    /**
     * @param {?} date
     * @param {?} startDayOfWeek
     * @param {?=} range
     * @return {?}
     */
    getDaysForMonth(date, startDayOfWeek, range = null) {
        const /** @type {?} */ firstDayOfMonth = this.getFirstWeekDayOfMonth(date, startDayOfWeek);
        const /** @type {?} */ lastDayOfMonth = this.getLastWeekDayOfMonth(date, startDayOfWeek);
        const /** @type {?} */ max = this.dateDiff(firstDayOfMonth, lastDayOfMonth);
        const /** @type {?} */ days = [
            { date: firstDayOfMonth, highlights: this.getHighlights(range, firstDayOfMonth) },
        ];
        for (let /** @type {?} */ i = 0; i < max; i += 1) {
            const /** @type {?} */ nextDay = this.getNextDay(days[i].date);
            days.push({
                highlights: this.getHighlights(range, nextDay),
                date: nextDay,
            });
        }
        return days;
    }
    /**
     * @param {?} range
     * @param {?} date
     * @return {?}
     */
    getHighlights(range, date) {
        if (!range) {
            return '';
        }
        return Object.keys(range).filter((key) => {
            return this.inRange(range[key], date);
        }).join(' ');
    }
    /**
     * @param {?} range
     * @param {?} date
     * @return {?}
     */
    inRange(range, date) {
        return range.some((item) => {
            if (Array.isArray(item)) {
                return item.indexOf(date.getDay()) !== -1;
            }
            const /** @type {?} */ d = new Date(item);
            if (!isNaN(d.getTime())) {
                return this.compareDates(d, date);
            }
        });
    }
    /**
     * @param {?} days
     * @return {?}
     */
    getWeeksForMonth(days) {
        const /** @type {?} */ numberOfWeeks = Math.round(days.length / 7);
        return Array(numberOfWeeks).fill(null).map((label, index) => {
            return days.slice(index * 7, (index + 1) * 7);
        });
    }
    /**
     * @param {?} date
     * @return {?}
     */
    getLastDateOfMonth(date) {
        return new Date(date.getFullYear(), date.getMonth() + 1, 0);
    }
    /**
     * @param {?} date
     * @param {?} dayOfWeek
     * @param {?} orient
     * @return {?}
     */
    moveToDayOfWeek(date, dayOfWeek, orient) {
        let /** @type {?} */ diff = (dayOfWeek - date.getDay() + 7 * (orient || +1)) % 7;
        const /** @type {?} */ value = (diff === 0) ? diff += 7 * (orient || +1) : diff;
        const /** @type {?} */ d = new Date(date);
        return new Date(d.setDate(date.getDate() + value * 1));
    }
    /**
     * @param {?} date
     * @param {?} startOfWeek
     * @return {?}
     */
    getFirstWeekDayOfMonth(date, startOfWeek) {
        const /** @type {?} */ firstDayOfMonth = new Date(date.getFullYear(), date.getMonth(), 1);
        if (firstDayOfMonth.getDay() === Number(startOfWeek)) {
            return firstDayOfMonth;
        }
        return this.moveToDayOfWeek(firstDayOfMonth, Number(startOfWeek), -1);
    }
    /**
     * @param {?} date
     * @param {?} startOfWeek
     * @return {?}
     */
    getLastWeekDayOfMonth(date, startOfWeek) {
        const /** @type {?} */ endOfWeek = (startOfWeek === 0 ? 6 : startOfWeek - 1);
        const /** @type {?} */ lastDayOfMonth = this.getLastDateOfMonth(date);
        if (lastDayOfMonth.getDay() === endOfWeek) {
            return lastDayOfMonth;
        }
        return this.moveToDayOfWeek(lastDayOfMonth, endOfWeek, 1);
    }
    /**
     * @param {?} today
     * @return {?}
     */
    getNextDay(today) {
        const /** @type {?} */ tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);
        return tomorrow;
    }
    /**
     * @param {?} startDate
     * @param {?} endDate
     * @return {?}
     */
    dateDiff(startDate, endDate) {
        // Compare based on date, not on time
        const /** @type {?} */ start = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
        const /** @type {?} */ end = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate());
        return Math.round((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24));
    }
    /**
     * @param {?} date1
     * @param {?} date2
     * @return {?}
     */
    compareDates(date1, date2) {
        const /** @type {?} */ date1Year = date1.getFullYear();
        const /** @type {?} */ date1Month = date1.getMonth();
        const /** @type {?} */ date1Date = date1.getDate();
        const /** @type {?} */ date2Year = date2.getFullYear();
        const /** @type {?} */ date2Month = date2.getMonth();
        const /** @type {?} */ date2Date = date2.getDate();
        return date1Year === date2Year && date1Month === date2Month && date1Date === date2Date;
    }
    /**
     * @param {?} startDayOfWeek
     * @return {?}
     */
    orderWeekDays(startDayOfWeek) {
        const /** @type {?} */ rotate = function (array, index) {
            const /** @type {?} */ arrayLength = array.length;
            return array.slice(arrayLength - index).concat(array.slice(0, arrayLength - index));
        };
        const /** @type {?} */ weekdays = [0, 1, 2, 3, 4, 5, 6];
        if (startDayOfWeek === DAYS.SUNDAY) {
            return weekdays;
        }
        else {
            return rotate(weekdays, 7 - startDayOfWeek);
        }
    }
}
DateHelperService.decorators = [
    { type: Injectable },
];

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1oZWxwZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FnZW5kYS8iLCJzb3VyY2VzIjpbImxpYi9hZ2VuZGEvc2VydmljZXMvZGF0ZS1oZWxwZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBSU4sSUFBSSxHQUNKLE1BQU0sdUJBQXVCLENBQUM7QUFHL0IsTUFBTTs7Ozs7OztJQUVFLGVBQWUsQ0FBQyxJQUFVLEVBQUUsY0FBc0IsRUFBRSxRQUE0QixJQUFJO1FBQzFGLHVCQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQzFFLHVCQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQ3hFLHVCQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUUzRCx1QkFBTSxJQUFJLEdBQUc7WUFDWixFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLGVBQWUsQ0FBQyxFQUFFO1NBQ2pGLENBQUM7UUFFRixHQUFHLENBQUMsQ0FBQyxxQkFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ2pDLHVCQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUU5QyxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUNULFVBQVUsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7Z0JBQzlDLElBQUksRUFBRSxP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LEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxXQUFXLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUNwRixDQUFDO1FBQ0YsdUJBQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFdkMsRUFBRSxDQUFDLENBQUMsY0FBYyxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxRQUFRLENBQUM7U0FDaEI7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNQLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUMsR0FBRyxjQUFjLENBQUMsQ0FBQztTQUM1Qzs7OztZQXZIRixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVE9ETzogTW92ZSB0aGlzIHRvIEBhY3BhYXMtdWkvanMtZGF0ZS11dGlsc1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1xuXHRXZWVrZGF5SW50ZXJmYWNlLFxuXHRIaWdoTGlnaHRJbnRlcmZhY2UsXG5cdFJhbmdlSW50ZXJmYWNlLFxuXHREQVlTLFxufSBmcm9tICcuLi90eXBlcy9hZ2VuZGEudHlwZXMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGF0ZUhlbHBlclNlcnZpY2Uge1xuXG5cdHB1YmxpYyBnZXREYXlzRm9yTW9udGgoZGF0ZTogRGF0ZSwgc3RhcnREYXlPZldlZWs6IG51bWJlciwgcmFuZ2U6IEhpZ2hMaWdodEludGVyZmFjZSA9IG51bGwpOiBXZWVrZGF5SW50ZXJmYWNlW10ge1xuXHRcdGNvbnN0IGZpcnN0RGF5T2ZNb250aCA9IHRoaXMuZ2V0Rmlyc3RXZWVrRGF5T2ZNb250aChkYXRlLCBzdGFydERheU9mV2Vlayk7XG5cdFx0Y29uc3QgbGFzdERheU9mTW9udGggPSB0aGlzLmdldExhc3RXZWVrRGF5T2ZNb250aChkYXRlLCBzdGFydERheU9mV2Vlayk7XG5cdFx0Y29uc3QgbWF4ID0gdGhpcy5kYXRlRGlmZihmaXJzdERheU9mTW9udGgsIGxhc3REYXlPZk1vbnRoKTtcblxuXHRcdGNvbnN0IGRheXMgPSBbXG5cdFx0XHR7IGRhdGU6IGZpcnN0RGF5T2ZNb250aCwgaGlnaGxpZ2h0czogdGhpcy5nZXRIaWdobGlnaHRzKHJhbmdlLCBmaXJzdERheU9mTW9udGgpIH0sXG5cdFx0XTtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4OyBpICs9IDEpIHtcblx0XHRcdGNvbnN0IG5leHREYXkgPSB0aGlzLmdldE5leHREYXkoZGF5c1tpXS5kYXRlKTtcblxuXHRcdFx0ZGF5cy5wdXNoKHtcblx0XHRcdFx0aGlnaGxpZ2h0czogdGhpcy5nZXRIaWdobGlnaHRzKHJhbmdlLCBuZXh0RGF5KSxcblx0XHRcdFx0ZGF0ZTogbmV4dERheSxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXlzO1xuXHR9XG5cblx0cHVibGljIGdldEhpZ2hsaWdodHMocmFuZ2U6IEhpZ2hMaWdodEludGVyZmFjZSwgZGF0ZTogRGF0ZSk6IHN0cmluZyB7XG5cdFx0aWYgKCFyYW5nZSkge1xuXHRcdFx0cmV0dXJuICcnO1xuXHRcdH1cblxuXHRcdHJldHVybiBPYmplY3Qua2V5cyhyYW5nZSkuZmlsdGVyKChrZXkpID0+IHtcblx0XHRcdHJldHVybiB0aGlzLmluUmFuZ2UocmFuZ2Vba2V5XSwgZGF0ZSk7XG5cdFx0fSkuam9pbignICcpO1xuXHR9XG5cblx0cHVibGljIGluUmFuZ2UocmFuZ2U6IFJhbmdlSW50ZXJmYWNlLCBkYXRlOiBEYXRlKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHJhbmdlLnNvbWUoKGl0ZW0pID0+IHtcblx0XHRcdGlmIChBcnJheS5pc0FycmF5KGl0ZW0pKSB7XG5cdFx0XHRcdHJldHVybiBpdGVtLmluZGV4T2YoZGF0ZS5nZXREYXkoKSkgIT09IC0xO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBkID0gbmV3IERhdGUoaXRlbSk7XG5cdFx0XHRpZiAoIWlzTmFOKGQuZ2V0VGltZSgpKSkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5jb21wYXJlRGF0ZXMoZCwgZGF0ZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0V2Vla3NGb3JNb250aChkYXlzOiBXZWVrZGF5SW50ZXJmYWNlW10pOiBXZWVrZGF5SW50ZXJmYWNlW11bXSB7XG5cdFx0Y29uc3QgbnVtYmVyT2ZXZWVrcyA9IE1hdGgucm91bmQoZGF5cy5sZW5ndGggLyA3KTtcblxuXHRcdHJldHVybiBBcnJheShudW1iZXJPZldlZWtzKS5maWxsKG51bGwpLm1hcCgobGFiZWwsIGluZGV4KSA9PiB7XG5cdFx0XHRyZXR1cm4gZGF5cy5zbGljZShpbmRleCAqIDcsIChpbmRleCArIDEpICogNyk7XG5cdFx0fSk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0TGFzdERhdGVPZk1vbnRoKGRhdGU6IERhdGUpOiBEYXRlIHtcblx0XHRyZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkgKyAxLCAwKTtcblx0fVxuXG5cdHB1YmxpYyBtb3ZlVG9EYXlPZldlZWsoZGF0ZTogRGF0ZSwgZGF5T2ZXZWVrOiBudW1iZXIsIG9yaWVudDogbnVtYmVyKTogRGF0ZSB7XG5cdFx0bGV0IGRpZmYgPSAoZGF5T2ZXZWVrIC0gZGF0ZS5nZXREYXkoKSArIDcgKiAob3JpZW50IHx8ICsgMSkpICUgNztcblx0XHRjb25zdCB2YWx1ZSA9IChkaWZmID09PSAwKSA/IGRpZmYgKz0gNyAqIChvcmllbnQgfHwgKzEpIDogZGlmZjtcblx0XHRjb25zdCBkID0gbmV3IERhdGUoZGF0ZSk7XG5cdFx0cmV0dXJuIG5ldyBEYXRlKGQuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIHZhbHVlICogMSkpO1xuXHR9XG5cblx0cHVibGljIGdldEZpcnN0V2Vla0RheU9mTW9udGgoZGF0ZTogRGF0ZSwgc3RhcnRPZldlZWs6IG51bWJlcnxzdHJpbmcpOiBEYXRlIHtcblx0XHRjb25zdCBmaXJzdERheU9mTW9udGggPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSwgMSk7XG5cdFx0aWYgKGZpcnN0RGF5T2ZNb250aC5nZXREYXkoKSA9PT0gTnVtYmVyKHN0YXJ0T2ZXZWVrKSkge1xuXHRcdFx0cmV0dXJuIGZpcnN0RGF5T2ZNb250aDtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMubW92ZVRvRGF5T2ZXZWVrKGZpcnN0RGF5T2ZNb250aCwgTnVtYmVyKHN0YXJ0T2ZXZWVrKSwgLTEpO1xuXHR9XG5cblx0cHVibGljIGdldExhc3RXZWVrRGF5T2ZNb250aChkYXRlOiBEYXRlLCBzdGFydE9mV2VlazogbnVtYmVyKTogRGF0ZSB7XG5cdFx0Y29uc3QgZW5kT2ZXZWVrID0gKHN0YXJ0T2ZXZWVrID09PSAwID8gNiA6IHN0YXJ0T2ZXZWVrIC0gMSk7XG5cdFx0Y29uc3QgbGFzdERheU9mTW9udGggPSB0aGlzLmdldExhc3REYXRlT2ZNb250aChkYXRlKTtcblx0XHRpZiAobGFzdERheU9mTW9udGguZ2V0RGF5KCkgPT09IGVuZE9mV2Vlaykge1xuXHRcdFx0cmV0dXJuIGxhc3REYXlPZk1vbnRoO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5tb3ZlVG9EYXlPZldlZWsobGFzdERheU9mTW9udGgsIGVuZE9mV2VlaywgMSk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0TmV4dERheSh0b2RheTogRGF0ZSk6IERhdGUge1xuXHRcdGNvbnN0IHRvbW9ycm93ID0gbmV3IERhdGUodG9kYXkpO1xuXHRcdHRvbW9ycm93LnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpICsgMSk7XG5cdFx0cmV0dXJuIHRvbW9ycm93O1xuXHR9XG5cblx0cHVibGljIGRhdGVEaWZmKHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IG51bWJlciB7XG5cdFx0Ly8gQ29tcGFyZSBiYXNlZCBvbiBkYXRlLCBub3Qgb24gdGltZVxuXHRcdGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoc3RhcnREYXRlLmdldEZ1bGxZZWFyKCksIHN0YXJ0RGF0ZS5nZXRNb250aCgpLCBzdGFydERhdGUuZ2V0RGF0ZSgpKTtcblx0XHRjb25zdCBlbmQgPSBuZXcgRGF0ZShlbmREYXRlLmdldEZ1bGxZZWFyKCksIGVuZERhdGUuZ2V0TW9udGgoKSwgZW5kRGF0ZS5nZXREYXRlKCkpO1xuXG5cdFx0cmV0dXJuIE1hdGgucm91bmQoKGVuZC5nZXRUaW1lKCkgLSBzdGFydC5nZXRUaW1lKCkpIC8gKCAxMDAwICogNjAgKiA2MCAqIDI0KSk7XG5cdH1cblxuXHRwdWJsaWMgY29tcGFyZURhdGVzKGRhdGUxOiBEYXRlLCBkYXRlMjogRGF0ZSk6IGJvb2xlYW4ge1xuXHRcdGNvbnN0IGRhdGUxWWVhciA9IGRhdGUxLmdldEZ1bGxZZWFyKCk7XG5cdFx0Y29uc3QgZGF0ZTFNb250aCA9IGRhdGUxLmdldE1vbnRoKCk7XG5cdFx0Y29uc3QgZGF0ZTFEYXRlID0gZGF0ZTEuZ2V0RGF0ZSgpO1xuXHRcdGNvbnN0IGRhdGUyWWVhciA9IGRhdGUyLmdldEZ1bGxZZWFyKCk7XG5cdFx0Y29uc3QgZGF0ZTJNb250aCA9IGRhdGUyLmdldE1vbnRoKCk7XG5cdFx0Y29uc3QgZGF0ZTJEYXRlID0gZGF0ZTIuZ2V0RGF0ZSgpO1xuXG5cdFx0cmV0dXJuIGRhdGUxWWVhciA9PT0gZGF0ZTJZZWFyICYmIGRhdGUxTW9udGggPT09IGRhdGUyTW9udGggJiYgZGF0ZTFEYXRlID09PSBkYXRlMkRhdGU7XG5cdH1cblxuXHRwdWJsaWMgb3JkZXJXZWVrRGF5cyhzdGFydERheU9mV2VlazogREFZUyk6IERBWVNbXSB7XG5cdFx0Y29uc3Qgcm90YXRlID0gZnVuY3Rpb24gKGFycmF5LCBpbmRleCkge1xuXHRcdFx0Y29uc3QgYXJyYXlMZW5ndGggPSBhcnJheS5sZW5ndGg7XG5cdFx0XHRyZXR1cm4gYXJyYXkuc2xpY2UoYXJyYXlMZW5ndGggLSBpbmRleCkuY29uY2F0KGFycmF5LnNsaWNlKDAsIGFycmF5TGVuZ3RoIC0gaW5kZXgpKTtcblx0XHR9O1xuXHRcdGNvbnN0IHdlZWtkYXlzID0gWzAsIDEsIDIsIDMsIDQsIDUsIDZdO1xuXG5cdFx0aWYgKHN0YXJ0RGF5T2ZXZWVrID09PSBEQVlTLlNVTkRBWSkge1xuXHRcdFx0cmV0dXJuIHdlZWtkYXlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gcm90YXRlKHdlZWtkYXlzLCA3IC0gc3RhcnREYXlPZldlZWspO1xuXHRcdH1cblx0fVxufVxuIl19